{% extends 'base.html'%}
{% load static %}
{% block content %}
<style>
.title{
    width:100%;
    max-width:200px;

}
input:focus {
    outline:none;
}

textarea:focus{
    outline:none;
}
.confirmBtn {
  margin-top: 10px;
  width: 100px;
  color: white;
  background-color: #ff8668;
  padding: 6px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
}
.ul_cover_div{
    padding:10px;
    max-width:400px;
}
.ul_cover_p{
    width:100%;
    text-align:center;
}
#nick{
    {% comment %} input {% endcomment %}
    width:60%;
    border:none;
    text-align:center;
}
.nickli{
    margin:10px;
    padding:5px;
    white-space:nowrap; 
    overflow:scroll;
    list-style:none;

}
.nickli:hover{
    cursor:pointer;
    background:lightgray;
    border-radius:5px;
}
.nickul{
    padding:0;
    text-align:center;
    border:1px solid lightgray;
    border-radius:5px;
}
.spanline{
    
    border: 1px solid lightgray;
    border-radius : 5px;
    padding : 5px;
    margin-right:10px;
    
}
.spanline:hover{
    background:lightgray;
}
.spanline i:hover{
    cursor:pointer;
}


.parti_cover{
    border: 1px solid lightgray;
    border-radius : 5px;
    padding : 10px;
    height:90px;
    overflow:scroll;
    white-space: nowrap;
}
.out{
    border:1px solid lightgray;
    border-radius : 5px;
    padding : 10px;
    
}
</style>
  <script  src="{% static 'js/jquery-latest.min.js' %}"></script>

<section style="padding-left: 160px; padding-right:160px;" id="portfolio-details" class="portfolio-details">
    <div class="container shadow-hover out" style="max-width:650px; padding:30px;">
        <h2>방 생성</h2><br>
        <form action="{%url 'shared_chat:saveroominfo' room.id %}" method="post" enctype="multipart/form-data">
            {%csrf_token%}
            <p>방 명<br> <input class="title out shadow-hover" value="{{room.name}}" type="text" name="name" required></p>
            <p>방 설명  <textarea class="out shadow-hover" style="width: 100%;" type="text" name="description" id="" cols="50" rows="3"
                    required>{{room.description}}</textarea></p>
            <p style="color:gray"># 아래에서 참가시킬분의 닉네임을 검색하시고 선택해주세요</p>
            <div class="ul_cover_div">
                <p class="ul_cover_p"><i class="bi bi-search me-2"></i><input style="padding:5px; border-radius:3px;" class="shadow-hover" placeholder="닉네임 검색 " type="text" id="nick" onkeyup="search(this);"></p> 
                <hr>
                <ul class="shadow-hover" id="nicklist"></ul>
            </div>

            <div class="shadow-hover parti_cover">
            <p>참가자 명단</p>
            <div class="participants"></div>
            </div>
            <button class="shadow-hover confirmBtn" type="submit">저장</button>
        </form>
    </div>
</section>

<script>
    function i_minus(e){
        var id = $(e).attr('id');
        $(`.participant${id}`).remove();
    }
    function li_click(e){
        var li_t=$(e).text();
        var li_id=$(e).attr('id');
        $('.participants').append(`<span class="shadow-hover spanline participant${li_id}"><i id="${li_id}" onclick="i_minus(this)" class="bi bi-dash-square"></i>${li_t}</span>`);
    }
   
    function search(target){
        var nick = target.value;
        var info={
            'nick':nick,
        };
        $.ajax({
            headers:{
                'X-CSRFTOKEN': '{{ csrf_token }}',
            },
            url : "{% url 'shared_chat:nick_check' %}",
            type : 'POST',
            dataType : 'json',
            data : JSON.stringify(info),

            success: function (response){
                list=response;
                
                if(Object.keys(list).length==0){
                    $('#nicklist').removeClass("nickul");
                }
                else{
                    $('#nicklist').addClass("nickul");
                }
                $('#nicklist').empty();
                for(var key in list){
                    
                    $('#nicklist').append(`
                    <li id="${key}" onclick="li_click(this)" class="nickli">
                    ${list[key]}
                    </li>
                    `);
                    
                }

            },

            error: function(response){
                console.log("ajax error");
            },

        });

    }
    
</script>


{% endblock %}